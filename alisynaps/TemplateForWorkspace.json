{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "alisynaps"
		},
		"alisynaps-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'alisynaps-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:alisynaps.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"alisynaps-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://alidatalakebrief.dfs.core.windows.net"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/sparkpool')]",
			"type": "Microsoft.Synapse/workspaces/bigDataPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/alisynaps-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('alisynaps-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/alisynaps-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('alisynaps-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/transformation')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "sparkpool",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"runAsWorkspaceSystemIdentity": false,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2",
						"spark.autotune.trackingId": "6b63fc85-bccd-4715-beca-7b0614ad8d08"
					}
				},
				"metadata": {
					"saveOutput": true,
					"synapse_widget": {
						"version": "0.1",
						"state": {
							"ed58c01e-0daf-4b2f-b594-d3b0e35ed2d7": {
								"type": "Synapse.DataFrame",
								"sync_state": {
									"table": {
										"rows": [
											{
												"0": "2",
												"1": "2024-01-01 00:46:55",
												"2": "2024-01-01 00:58:25",
												"3": "N",
												"4": "1",
												"5": "236",
												"6": "239",
												"7": "1",
												"8": "1.98",
												"9": "12.8",
												"10": "1.0",
												"11": "0.5",
												"12": "3.61",
												"13": "0.0",
												"15": "1.0",
												"16": "21.66",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:31:42",
												"2": "2024-01-01 00:52:34",
												"3": "N",
												"4": "1",
												"5": "65",
												"6": "170",
												"7": "5",
												"8": "6.54",
												"9": "30.3",
												"10": "1.0",
												"11": "0.5",
												"12": "7.11",
												"13": "0.0",
												"15": "1.0",
												"16": "42.66",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:30:21",
												"2": "2024-01-01 00:49:23",
												"3": "N",
												"4": "1",
												"5": "74",
												"6": "262",
												"7": "1",
												"8": "3.08",
												"9": "19.8",
												"10": "1.0",
												"11": "0.5",
												"12": "3.0",
												"13": "0.0",
												"15": "1.0",
												"16": "28.05",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "1",
												"1": "2024-01-01 00:30:20",
												"2": "2024-01-01 00:42:12",
												"3": "N",
												"4": "1",
												"5": "74",
												"6": "116",
												"7": "1",
												"8": "2.4",
												"9": "14.2",
												"10": "1.0",
												"11": "1.5",
												"12": "0.0",
												"13": "0.0",
												"15": "1.0",
												"16": "16.7",
												"17": "2",
												"18": "1",
												"19": "0.0"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:32:38",
												"2": "2024-01-01 00:43:37",
												"3": "N",
												"4": "1",
												"5": "74",
												"6": "243",
												"7": "1",
												"8": "5.14",
												"9": "22.6",
												"10": "1.0",
												"11": "0.5",
												"12": "6.28",
												"13": "0.0",
												"15": "1.0",
												"16": "31.38",
												"17": "1",
												"18": "1",
												"19": "0.0"
											},
											{
												"0": "1",
												"1": "2024-01-01 00:43:41",
												"2": "2024-01-01 01:00:23",
												"3": "N",
												"4": "1",
												"5": "33",
												"6": "209",
												"7": "1",
												"8": "2.0",
												"9": "17.0",
												"10": "3.75",
												"11": "1.5",
												"12": "2.0",
												"13": "0.0",
												"15": "1.0",
												"16": "24.25",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "1",
												"1": "2024-01-01 00:31:56",
												"2": "2024-01-01 00:48:09",
												"3": "N",
												"4": "1",
												"5": "74",
												"6": "238",
												"7": "2",
												"8": "3.2",
												"9": "18.4",
												"10": "3.75",
												"11": "1.5",
												"12": "4.7",
												"13": "0.0",
												"15": "1.0",
												"16": "28.35",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:46:12",
												"2": "2024-01-01 00:57:39",
												"3": "N",
												"4": "1",
												"5": "166",
												"6": "239",
												"7": "2",
												"8": "2.01",
												"9": "13.5",
												"10": "1.0",
												"11": "0.5",
												"12": "5.62",
												"13": "0.0",
												"15": "1.0",
												"16": "24.37",
												"17": "1",
												"18": "1",
												"19": "2.75"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:38:07",
												"2": "2024-01-01 00:39:23",
												"3": "N",
												"4": "1",
												"5": "226",
												"6": "226",
												"7": "1",
												"8": "0.31",
												"9": "3.7",
												"10": "1.0",
												"11": "0.5",
												"12": "0.0",
												"13": "0.0",
												"15": "1.0",
												"16": "6.2",
												"17": "2",
												"18": "1",
												"19": "0.0"
											},
											{
												"0": "2",
												"1": "2024-01-01 00:44:24",
												"2": "2024-01-01 00:57:47",
												"3": "N",
												"4": "1",
												"5": "7",
												"6": "129",
												"7": "1",
												"8": "2.32",
												"9": "14.9",
												"10": "1.0",
												"11": "0.5",
												"12": "3.48",
												"13": "0.0",
												"15": "1.0",
												"16": "20.88",
												"17": "1",
												"18": "1",
												"19": "0.0"
											}
										],
										"schema": [
											{
												"key": "0",
												"name": "VendorID",
												"type": "int"
											},
											{
												"key": "1",
												"name": "lpep_pickup_datetime",
												"type": "timestamp_ntz"
											},
											{
												"key": "2",
												"name": "lpep_dropoff_datetime",
												"type": "timestamp_ntz"
											},
											{
												"key": "3",
												"name": "store_and_fwd_flag",
												"type": "string"
											},
											{
												"key": "4",
												"name": "RatecodeID",
												"type": "bigint"
											},
											{
												"key": "5",
												"name": "PULocationID",
												"type": "int"
											},
											{
												"key": "6",
												"name": "DOLocationID",
												"type": "int"
											},
											{
												"key": "7",
												"name": "passenger_count",
												"type": "bigint"
											},
											{
												"key": "8",
												"name": "trip_distance",
												"type": "double"
											},
											{
												"key": "9",
												"name": "fare_amount",
												"type": "double"
											},
											{
												"key": "10",
												"name": "extra",
												"type": "double"
											},
											{
												"key": "11",
												"name": "mta_tax",
												"type": "double"
											},
											{
												"key": "12",
												"name": "tip_amount",
												"type": "double"
											},
											{
												"key": "13",
												"name": "tolls_amount",
												"type": "double"
											},
											{
												"key": "14",
												"name": "ehail_fee",
												"type": "double"
											},
											{
												"key": "15",
												"name": "improvement_surcharge",
												"type": "double"
											},
											{
												"key": "16",
												"name": "total_amount",
												"type": "double"
											},
											{
												"key": "17",
												"name": "payment_type",
												"type": "bigint"
											},
											{
												"key": "18",
												"name": "trip_type",
												"type": "bigint"
											},
											{
												"key": "19",
												"name": "congestion_surcharge",
												"type": "double"
											}
										],
										"truncated": false
									},
									"isSummary": false,
									"language": "scala",
									"wranglerEntryContext": {
										"dataframeType": "pyspark"
									}
								},
								"persist_state": {
									"view": {
										"type": "details",
										"chartOptions": {
											"chartType": "bar",
											"aggregationType": "sum",
											"categoryFieldKeys": [
												"3"
											],
											"seriesFieldKeys": [
												"0"
											],
											"isStacked": false
										}
									}
								}
							}
						}
					},
					"enableDebugMode": false,
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/59b3f2eb-caba-469e-afca-cde678d49c24/resourceGroups/arahiqi/providers/Microsoft.Synapse/workspaces/alisynaps/bigDataPools/sparkpool",
						"name": "sparkpool",
						"type": "Spark",
						"endpoint": "https://alisynaps.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/sparkpool",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net",
							"authHeader": null
						},
						"sparkVersion": "3.4",
						"nodeCount": 10,
						"cores": 4,
						"memory": 28,
						"extraHeader": null
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "code",
						"metadata": {
							"collapsed": false
						},
						"source": [
							"df = spark.read.load('abfss://raw@alidatalakebrief.dfs.core.windows.net/2024/01/green_tripdata_2024-01.parquet', format='parquet')\r\n",
							"display(df.limit(10))"
						],
						"outputs": [],
						"execution_count": 2
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/sparkpool')]",
			"type": "Microsoft.Synapse/workspaces/bigDataPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"autoPause": {
					"enabled": true,
					"delayInMinutes": 15
				},
				"autoScale": {
					"enabled": true,
					"maxNodeCount": 10,
					"minNodeCount": 3
				},
				"nodeCount": 10,
				"nodeSize": "Small",
				"nodeSizeFamily": "MemoryOptimized",
				"sparkVersion": "3.4",
				"isComputeIsolationEnabled": false,
				"sessionLevelPackagesEnabled": false,
				"annotations": []
			},
			"dependsOn": [],
			"location": "uksouth"
		}
	]
}